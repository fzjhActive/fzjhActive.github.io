<!DOCTYPE html>

<html><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8">

<meta name="viewport" content="width=device-width, initial-scale=1">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="renderer" content="webkit">
<title>放置江湖主动查询表</title>
<link rel="shortcut icon" href="img/icon.png" >
<script src="js/jquery-3.3.1.min.js"></script>
<script src="js/activeSkill.js"></script>
<script src="js/version.js"></script>
<script src="js/math.min.js"></script>
<script src="js/common.js"></script>
<script src="https://pv.sohu.com/cityjson?ie=utf-8"></script> 

<link rel="stylesheet" type="text/css" href="css/style.css">
<style type="text/css">
  body {
    margin: 0;
    font-family: arial;
  }






  table {
    border: 1px solid #ccc;
    width: 80%;
    margin:0;
    padding:0;
    border-collapse: collapse;
    border-spacing: 0;
    margin: 0 auto;
  }

  table tr {
    border: 1px solid #ddd;
    padding: 5px;
  }

  table th, table td {
    padding: 10px;
    text-align: center;
  }

  table th {
    text-transform: uppercase;
    font-size: 14px;
    letter-spacing: 1px;
  }
  #skilltype{
  	font-size:8px; 
  }
  @media screen and (max-width: 600px) {

    table {
      border: 0;
    }

    table thead {
      display: none;
    }

    table tr {
      margin-bottom: 10px;
      display: block;
      border-bottom: 2px solid #ddd;
    }

    table td {
      display: block;
      text-align: right;
      font-size: 13px;
      border-bottom: 1px dotted #ccc;
    }

    table td:last-child {
      border-bottom: 0;
    }

    table td:before {
      content: attr(data-label);
      float: left;
      text-transform: uppercase;
      font-weight: bold;
    }
  }
  a{
  	font-weight: 600;
  }
  .select {
    margin: 0 2.5%;
    
  }
  select{
    text-align: center;
    margin: 0 auto;
    width: 100%;
    border: 1px solid #aaa;
    border-radius: 4px;
    background: transparent;
  }
  .chongshu {
  	width: 45%;
  	position: relative;
  	margin: 0 auto;
  	left: 2.5%;
  	height: 20px;
  	display: inline-block;
  }     
  .searcher {
    height: 20px;
    width: 45%;
    position: relative;
    left: 5%;
    display: inline-block;
    margin: 0 auto;
    background: rgba(255, 255, 255, 0);
    text-align: center;
    font-size: 16px;
  }
  .searcher-main {
   margin: 0 0;
   border: 1px solid #aaa;
   border-radius: 4px;
 }

 .searcher-text {
   width: 80%;
   text-align: center;
   border: none;
   outline: none;
 }
 .searcher2 {
    height: 20px;
    width: 95%;
    margin: 0 auto;
    background: rgba(255, 255, 255, 0);
    text-align: center;
    font-size: 16px;
  }
  .searcher-main2 {
   margin: 0 0;
   border: 1px solid #aaa;
   border-radius: 4px;
 }

 .searcher-text2 {
   width: 80%;
   text-align: center;
   border: none;
   outline: none;
 }


 .skillInfoWindow {

  display: none;
  background-color: rgba(224, 224, 224, 0.8);
  width: 80%;
  border: 1px solid #000000;
  border-radius: 10px;
  position:fixed;
  bottom: 10%;
  left: 9%;
  z-index: 999;
  text-align: left;
  max-height: 80%;
  overflow-y: auto;
}
/*.skillInfo:hover .skillInfoWindow{
  display: block;
}*/
.closebutton {
  float:right;
  background: rgba(224, 224, 224, 0.8);
  color: red;
  border-radius: 10px;
  line-height: 20px;
  text-align: center;
  height: 20px;
  width: 20px;
  font-size: 10px;
  padding: 1px;
}
.closebutton::before{
  content:"\2716";
}

#familyselect{
  margin-top: 15px;
}
.calWindow{
  display: none;
  background-color: rgba(224, 224, 224);
  width: 80%;
  min-height: : 30%;
  border: 1px solid #000000;
  border-radius: 10px;
  position:fixed;
  top: 20%;
  left: 9%;
  z-index: 1001;
  text-align: left;
  max-height: 80%;
  overflow-y: auto;
  padding: 10px;
  text-align: center;
}
</style>
<!--[if IE]>
		
		<style type="text/css">			
			li.purchase a {
				padding-top: 5px;
				background-position: 0px -4px;
			}
			
			li.remove_frame a {
				padding-top: 5px;
				background-position: 0px -3px;
			}						
		</style>
		
    <![endif]-->
    <body>




      <div class="menu">
        <ul id="menu_list">
          <li><a href="index.html">主动查询表</a></li>
          <li><a href="exam.html">乡试与灯谜</a></li>
          <li><a href="exam2.html">殿试辅助</a></li>
          <li><a href="updatelog.html">更新日志</a></li>
        </ul>
      </div>

      <div class="note">
        <div class="title">
          <div id="menu_button">
            <h1>放置江湖主动查询表</h1>
            <div id="hamburger">
              <span></span>
              <span></span>
              <span></span>
            </div>
          </div>
        </div>
        <div class="select">
          <select required id="familyselect">
            <option value ="古墓">古墓(请选择门派)</option>
            <option value ="桃花岛">桃花岛</option>
            <option value="江湖">江湖</option>
            <option value="官府">官府</option>
            <option value="天山">天山</option>
            <option value="星宿">星宿</option>
            <option value="崆峒">崆峒</option>
            <option value="唐门">唐门</option>
            <option value="少林">少林</option>
            <option value="慕容">慕容</option>
            <option value="白驼山">白驼山</option>
            <option value="幽冥教">幽冥教</option>
            <option value="重光教">重光教</option>
            <option value="昆仑">昆仑</option>
            <option value="海鲸帮">海鲸帮</option>
            <option value="丐帮">丐帮</option>
            <option value="天龙寺">天龙寺</option>
            <option value="铁掌帮">铁掌帮</option>
            <option value="华山">华山</option>
            <option value="五毒教">五毒教</option>
            <option value="落月山庄">落月山庄</option>
            <option value="峨眉">峨眉</option>
            <option value="雪山寺">雪山寺</option>
            <option value="明教">明教</option>
            <option value="全真教">全真教</option>
            <option value="日月神教">日月神教</option>
            <option value="武当">武当</option>
            <option value="金钱帮">金钱帮</option>
          </select>
        </div>
        <div class="chongshu">
          <select required id = "skilllevel">
            <option value="1">1(请选择技能重数)</option>
            <option value="2">2</option>
            <option value="3">3</option>
            <option value="4">4</option>
            <option value="5">5</option>
            <option value="6">6</option>
            <option value="7">7</option>
            <option value="8">8</option>
            <option value="9">9</option>
          </select>
        </div>
        <div class="searcher">
          <p class="searcher-main">
           <input class="searcher-text" placeholder="请输入悟性"></input>
         </p>
       </div>
        <div class="searcher2">
          <p class="searcher-main2">
           <input class="searcher-text2" placeholder="技能搜索（技能/武学名称,效果名称）"></input>
         </p>
       </div>
     </div>
     <div class="tips">
       <p id="version">切换门派/重数查看主动效果，悟性为先天+后天值</p>
       <p>欢迎GG大玩家服的大侠加入放置江湖大玩家交流群663553792（GG大玩家服）</p>
     </div>
     <div class="searcher-result">

     </div>
     <div class="calWindow">
     </div>
   </div>



   <script>
    var searchContent;
    var clickFlag=true;
    var clickFlag2=true;
    var resultContent;
    var finishFlag = true;
    var result = new Array();
    $(document).ready(function(){
      if(isBaned(returnCitySN["cip"])){
      	window.location.href="about:blank";
      }else{
      	$('#version').empty();
	    $('#version').html("切换门派/重数查看主动效果，悟性为先天+后天值。点击粗体部分可查看更多详细信息。最近更新时间"+version);
	    checkCookie(version);
	    checkCookieNotice(notice,noticeContent,noticeLink);
	    if (finishFlag){
	      initSearchList();
        }
      
     }  
   });
  



    $('.searcher-text').on('input', function() {
      if (finishFlag){
       searchContent = (replaceIllegalStr($('.searcher-text2').val()));
     	if(searchContent.length>0){
     		searchSkill();
     	}else{
     		initSearchList();
     	}
     }  
   });
//   
    $(document).on('click',function(e){

    	// console.log( $(e.target).attr('id'));

      if (clickFlag){
        $('.skillInfoWindow').css('display',"none");
      }
      clickFlag=true;
      // if (clickFlag2){
      //   $('.calWindow').css('display',"none");
      // }
      // clickFlag2=true;
    });
    $('.searcher-text2').on('input', function() {
      if (finishFlag){
      	searchContent = (replaceIllegalStr($('.searcher-text2').val()));
     	if(searchContent.length>0){
     		searchSkill();
     	}else{
     		
     	}
      
     }  
   });
    $('#familyselect').on('change',function() {
    // alert("stop");
    if (finishFlag){
     initSearchList();
   }  
 });
    $('#skilllevel').on('change',function() {
    // alert("stop");
    if (finishFlag){
    	searchContent = (replaceIllegalStr($('.searcher-text2').val()));
     	if(searchContent.length>0){
     		searchSkill();
     	}else{
     		initSearchList();
     	}
        
   }
 });
    $('#menu_button').click(function(){
      var displayStatus = $('.menu').css('display');
      if (displayStatus == "block"){
        $('.menu').css('display',"none");
      }
      else{
        $('.menu').css('display',"block");
      }
      
    });
    
    function searchSkill(){
      finishFlag = false;
      resultContent = "";
      var options2=$("#skilllevel option:selected");
      skilllevel = options2.val();
      smart = Number(replaceIllegalStr($('.searcher-text').val()));
      result = new Array();
      searchContent = (replaceIllegalStr($('.searcher-text2').val()));
      for(var i=0; i<skillJson.length; i++){   
       var skillName =  skillJson[i]["SkillName"];
       var name =  skillJson[i]["name"];
       var effectAll =  skillJson[i]["effectAll"];

       if(typeof(skillName)=="string"){
	       if((skillName.indexOf(searchContent)>-1 || name.indexOf(searchContent)>-1 || effectAll.indexOf(searchContent)>-1)&& skillJson[i]["NameLv"]==Number(skilllevel)){
	        	result.push(i);
	       }
  		}	
      }
      result = uniq(result);
      resultContent = "<table><thead><tr><th>武学</th><th>主动</th><th>使用要求</th><th>描述</th><th>效果系数</th><th>冷却时间</th><th>内力消耗</th><th>领悟方式</th><th>所需残页</th></tr></thead><tbody>"
	  for(var j in result){
	    var i = result[j];
	    
	    pageNum=Math.ceil(0.15*(100*skilllevel)*(100*skilllevel)*(100*skilllevel)/500*100/(Number(skillJson[i]["potEfficiency"])*(200+smart)/200)/10/500);
	    resultContent = resultContent + "<tr class=\"skillInfo\">";
	    
	    resultContent = resultContent + "<td data-label=\"武学\">"+skillJson[i]["SkillName"]+"</td>";
	    resultContent = resultContent + "<td data-label=\"主动\">"+skillJson[i]["name"]+"</td>";
	    resultContent = resultContent + "<td data-label=\"使用要求\">"+skillJson[i]["cons"]+"</td>";
	    resultContent = resultContent + "<td data-label=\"描述\">"+skillJson[i]["desc"]+"</td>";
	    resultContent = resultContent + "<td data-label=\"效果系数\" class=\"effectClick\" id=\"effectFact"+ i +"\"><a onclick=\"onclicktr("+i+")\">"+skillJson[i]["effectAll"]+"</a></td>";
	    resultContent = resultContent + "<td data-label=\"冷却时间\">"+skillJson[i]["cd"]+"</td>";
	    resultContent = resultContent + "<td data-label=\"内力消耗\">"+skillJson[i]["cost"]+"</td>";
	    resultContent = resultContent + "<td data-label=\"领悟方式\">"+skillJson[i]["learnMethod"]+"</td>";
	    resultContent = resultContent + "<td data-label=\"所需残页\">"+pageNum + "("+skillJson[i]["level"]+")</td>";
	    resultContent = resultContent + "<td class=\"skillInfoWindow\" id=\"effectFactWindow"+ i +"\">";

	    resultContent = resultContent + "<center><b>" + skillJson[i]["name"] + "</b></center>";
	    resultContent = resultContent + skillJson[i]["effectInfo"];
	    resultContent = resultContent + "</td>";
	    resultContent = resultContent + "</tr>";
	  }
	  resultContent = resultContent  + "</tbody></table>"
	  $('.searcher-result').empty();
	  $('.searcher-result').html(resultContent);
	  finishFlag = true;
    
	}
    function initSearchList() {
      finishFlag = false;
      resultContent = "";
      result = new Array();
      var options1=$("#familyselect option:selected");
      family = options1.val();
      var options2=$("#skilllevel option:selected");
      skilllevel = options2.val();
      smart = Number(replaceIllegalStr($('.searcher-text').val()));

      for(var i=0; i<skillJson.length; i++){    
       if(skillJson[i]["family"]==family && skillJson[i]["NameLv"]==Number(skilllevel)){
        result.push(i)
      	}
    //result =uniq(result);
    //console.log(result.length);    
  	}
	  resultContent = "<table><thead><tr><th>武学</th><th>主动</th><th>使用要求</th><th>描述</th><th>效果系数</th><th>冷却时间</th><th>内力消耗</th><th>领悟方式</th><th>所需残页</th></tr></thead><tbody>"
	  for(var j in result){
	    var i = result[j];
	    //console.log(i);
	    pageNum=Math.ceil(0.15*(100*skilllevel)*(100*skilllevel)*(100*skilllevel)/500*100/(Number(skillJson[i]["potEfficiency"])*(200+smart)/200)/10/500);
	    resultContent = resultContent + "<tr class=\"skillInfo\">";
	    
	    resultContent = resultContent + "<td data-label=\"武学\">"+skillJson[i]["SkillName"]+"</td>";
	    resultContent = resultContent + "<td data-label=\"主动\">"+skillJson[i]["name"]+"</td>";
	    resultContent = resultContent + "<td data-label=\"使用要求\">"+skillJson[i]["cons"]+"</td>";
	    resultContent = resultContent + "<td data-label=\"描述\">"+skillJson[i]["desc"]+"</td>";
	     resultContent = resultContent + "<td data-label=\"效果系数\" class=\"effectClick\" id=\"effectFact"+ i +"\"><a onclick=\"onclicktr("+i+")\">"+skillJson[i]["effectAll"]+"</a></td>";
	    resultContent = resultContent + "<td data-label=\"冷却时间\">"+skillJson[i]["cd"]+"</td>";
	    resultContent = resultContent + "<td data-label=\"内力消耗\">"+skillJson[i]["cost"]+"</td>";
	    resultContent = resultContent + "<td data-label=\"领悟方式\">"+skillJson[i]["learnMethod"]+"</td>";
	    resultContent = resultContent + "<td data-label=\"所需残页\">"+pageNum + "("+skillJson[i]["level"]+")</td>";
	    resultContent = resultContent + "<td class=\"skillInfoWindow\" id=\"effectFactWindow"+ i +"\">";

	    resultContent = resultContent + "<center><b>" + skillJson[i]["name"] + "</b></center>";
	    resultContent = resultContent + skillJson[i]["effectInfo"];
	    resultContent = resultContent + "</td>";
	    resultContent = resultContent + "</tr>";
	  }
	  resultContent = resultContent  + "</tbody></table>"
	  $('.searcher-result').empty();
	  $('.searcher-result').html(resultContent);
	  finishFlag = true;
}

function uniq(array){
  var temp = [];
  for(var i = 0; i < array.length; i++){
    if(temp.indexOf(array[i]) == -1){
      temp.push(array[i]);
    }
  }
  return temp;
}
function replaceIllegalStr(str) {
 var reg;
 var illegal_list = ["/", "\\",
 "[", "]",
 "{", "}",
 "<", ">",
 "＜", "＞",
 "「", "」",
 "：", "；",
 "、", "•",
 "^", "'", "\"",
 "\r", "\r\n", "\\n", "\n"];
 for (var i = 0; i < illegal_list.length; i++) {
  if (str.indexOf(illegal_list[i]) >= 0) {
   if (illegal_list[i] == '\\' || illegal_list[i] == '[') {
    reg = new RegExp('\\' + illegal_list[i], "g");
  } else {
    reg = new RegExp(illegal_list[i], "g");
  }
  str = str.replace(reg, '');
}
}
return str.trim();
}
function string2formula(str) {
	if(str.indexOf("if")!=-1){
		
	}
}
function onclicktr(index){
	console.log(index);
	clickFlag= false;
	
	var displayStatus = $('#effectFactWindow'+index).css('display');
      if (displayStatus == "block"){
      	$('.skillInfoWindow').css('display',"none");
        $('#effectFactWindow'+index).css('display',"none");
      }
      else{
      	$('.skillInfoWindow').css('display',"none");
        $('#effectFactWindow'+index).css('display',"block");
      }
}
function calthisEffect(skillIndex, effectIndex){

	clickFlag2= false;
	var displayStatus = $('.calWindow').css('display');
	console.log(displayStatus);
      if (displayStatus == "block"){
      	$('.calWindow').css('display',"none");
      }
      else{
      	$('.calWindow').css('display',"block");
      }
	// $('.calWindow').css("display")="block";
	$('.calWindow').empty();
	var cal = new calculations();
	cal.create(skillJson[skillIndex]["effectGS"][effectIndex]);
	// console.log(cal.needList);
	
	var htmlString = "";
	var needList = Array.from(cal.needList);
	var needListCN = Array.from(cal.needListCN);
	for(var i=0;i<needList.length;i++){
		var varInCookie=getCookie(needList[i]);
		htmlString = htmlString + needListCN[i] + "<input id = \"" + needList[i]+"\" value = " + varInCookie+"></input><br/>"

	}
	var effectPart = skillJson[skillIndex]["effectAll"].split("<br/>")[effectIndex];
	var effectName = effectPart.slice(0,effectPart.indexOf("]")+1);
	var effectTime = parseFloat(effectPart.slice(effectPart.indexOf("持续时间")+"持续时间".length,effectPart.indexOf("<",effectPart.indexOf("持续时间"))));
	var effectTimeInt = Math.ceil(effectTime/2.0);
	var effectTimeStr="";
	if(effectTimeInt>0){
		effectTimeStr = "x" + effectTimeInt + "次（每2秒触发一次），需要一定条件触发的主动则没有固定次数";
	}
	htmlString = htmlString + effectName + ":\t<span id='effectCalResult'>___</span>"+ effectTimeStr+"<br/>";
	htmlString = htmlString + "<input type='submit' onclick='calEffectFinal("+skillIndex+","+effectIndex+")' value='计算'></input><br/>";
	htmlString = htmlString + "<input type='submit' onclick='closeCalWindow()' value='关闭'></input><br/>";
	$('.calWindow').html(htmlString);
}
function calEffectFinal(skillIndex, effectIndex){
	clickFlag2 = false;
	clickFlag = false;
	var cal = new calculations();
	cal.create(skillJson[skillIndex]["effectGS"][effectIndex]);
	var needList = Array.from(cal.needList);
	var needListCN = Array.from(cal.needListCN);
	var results = {};
	for(var i=0;i<needList.length;i++){
		//console.log(needList[i]);
		//console.log(document.getElementById(needList[i]).value);

		results[needList[i]] = parseInt(document.getElementById(needList[i]).value.replace(/[^\d]/g,''));
		setCookie(needList[i], results[needList[i]],365);
	}

	var result = cal.cal(results,parseInt(skillJson[skillIndex]["cost"]));
	$('#effectCalResult').html(result);
	// console.log(result);
}
function closeCalWindow(){
	$('.calWindow').css('display',"none");
}
</script>
<p class="law">
  内容均来自网络或自行测试得出，如有侵权，立即删除
  <script type="text/javascript">var cnzz_protocol = (("https:" == document.location.protocol) ? " https://" : " http://");document.write(unescape("%3Cspan id='cnzz_stat_icon_1274974079'%3E%3C/span%3E%3Cscript src='" + cnzz_protocol + "s19.cnzz.com/z_stat.php%3Fid%3D1274974079%26show%3Dpic1' type='text/javascript'%3E%3C/script%3E"));
  </script>
</p>
</body>
</html>